<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script>
        let score = 0, timer = 10, state = "NAME_INPUT";
        let mangroves = [];
        let playerName = "";
        let input, btn;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            
            // Setup Name Input UI
            input = createInput();
            input.position(width/2 - 80, height/2);
            input.attribute('placeholder', 'Your Name');
            
            btn = createButton('ENTER');
            btn.position(input.x + 60, input.y + 35);
            btn.mousePressed(goToMessage);
        }

        function goToMessage() {
            if (input.value() !== "") {
                playerName = input.value();
                input.hide();
                btn.hide();
                state = "MESSAGE"; // Switch to message screen
            }
        }

        function draw() {
            if (state === "NAME_INPUT") {
                background(10, 20, 10);
                fill(255);
                textAlign(CENTER);
                textSize(28);
                text("COASTAL GUARDIAN REGISTRATION", width/2, height/2 - 60);
            } 
            else if (state === "MESSAGE") {
                background(20, 50, 20);
                fill(255);
                textAlign(CENTER);
                
                textSize(30);
                fill(255, 204, 0);
                text("HELLO, GUARDIAN " + playerName.toUpperCase() + "!", width/2, height/2 - 100);
                
                textSize(22);
                fill(255);
                text("Mangroves are in danger.", width/2, height/2 - 40);
                text("We need to save them for the sake of", width/2, height/2);
                text("people living there and fishes!", width/2, height/2 + 40);
                
                textSize(18);
                fill(150, 255, 150);
                text(">> CLICK ANYWHERE TO START THE 10s CHALLENGE <<", width/2, height/2 + 120);
            }
            else if (state === "PLAY") {
                playGame();
            } 
            else if (state === "END") {
                showResults();
            }
        }

        function playGame() {
            background(135, 206, 235); // Sky
            
            // Mud Zone (Interactable area)
            noStroke();
            fill(90, 70, 50);
            rect(0, height * 0.6, width, height * 0.4);

            // Render Mangroves
            for (let m of mangroves) {
                stroke(50, 40, 20);
                strokeWeight(3);
                line(m.x, m.y, m.x, m.y - 15);
                noStroke();
                fill(34, 139, 34);
                ellipse(m.x, m.y - 18, 12, 18);
            }

            // Status Bar
            fill(255);
            rect(0, 0, width, 50);
            fill(0);
            textAlign(LEFT);
            textSize(18);
            text("Guardian: " + playerName, 20, 32);
            textAlign(CENTER);
            text("Score: " + score, width/2, 32);
            textAlign(RIGHT);
            text("TIME LEFT: " + timer + "s", width - 20, 32);

            if (frameCount % 60 == 0 && timer > 0) timer--;
            if (timer <= 0) state = "END";
        }

        function showResults() {
            background(score >= 15 ? [0, 100, 0] : [150, 0, 0]);
            fill(255);
            textAlign(CENTER);
            textSize(40);
            text(score >= 15 ? "MISSION SUCCESS!" : "MISSION FAILED!", width/2, height/2 - 40);
            
            textSize(20);
            text(playerName + ", you planted " + score + " mangroves.", width/2, height/2 + 20);
            
            fill(255, 255, 0);
            text("CLICK TO RESTART", width/2, height/2 + 80);
        }

        function mousePressed() {
            if (state === "MESSAGE") {
                state = "PLAY"; // Now the game starts
            } else if (state === "PLAY" && mouseY > height * 0.6) {
                mangroves.push({x: mouseX, y: mouseY});
                score++;
            } else if (state === "END") {
                // Fully reset for the next player
                score = 0; 
                timer = 10; 
                mangroves = []; 
                state = "NAME_INPUT";
                input.show();
                btn.show();
                input.value('');
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>
